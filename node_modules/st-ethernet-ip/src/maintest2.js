const { Controller, TagList, Tag} = require('./index.js');

const tagList = new TagList();

// Controller.connect(IP_ADDR[, SLOT])
// NOTE: SLOT = 0 (default) - 0 if CompactLogix

connect()

function connect() {
  let PLC = new Controller();
  
  PLC.subscribe(new Tag('Integer2'))
  PLC.subscribe(new Tag('Integer3'))

  PLC.connect("192.168.86.200", 0).then(async () => {
      // Get all controller tags and program tags
      await PLC.getControllerTagList(tagList)

      // Displays all tags
      //console.log(tagList.tags)

      // Displays all templates
      //console.log(tagList.templates)

      // Displays program names
      //console.log(tagList.programs)
      let tag = new Tag('HugeIntArray', null, null, 0, 1)
      await PLC.readTag(tag, 5)
      tag.value = [1,1,1,1,1]
      await PLC.writeTag(tag)
      console.log(tag, tag.value)
  }).catch(e => {
    errorHandle(e, PLC, 5000)
  });
}

function errorHandle(e, PLC, retryDelay = 5000) {
  console.log('Error Handler: ', e)
  PLC.destroy()
  setTimeout(connect, retryDelay)
}