const {Controller} = require('./index.js');

const PLC = new Controller()

PLC.connect('192.168.86.200', 0).then(async () => {
    
    //Display controller tag list

    console.log()
    PLC.tagList.forEach(tag => {
      if((tag.name.slice(0,2) == 'Te' || tag.name.slice(0,2) == 'TE' || tag.name.slice(0,2) == 'te') && tag.type.typeName != 'MESSAGE') {
        console.log(tag.name, tag.program)

        PLC.newTag(tag.name, tag.program)
        
      }
    })
    
    PLC.newTag('UDT2_TEST')
    
    //Scan for changes in values in PLC or modified local values and updates at a rate of every 50mS
    PLC.scan_rate = 100;
    PLC.scan().catch(err => {
      console.log('SCAN ERROR:', err)
    });



    PLC.forEach(tag => {
    // Called if Tag.controller_value changes
    tag.on("Changed", (tag, oldValue) => {
        console.log("FROM:", oldValue)
        console.log("TO:", tag.value);

        if(tag.name == 'testString') {
          console.log('Changed')
          setTimeout(() => {
            tag.value = 'Top Notch';
            console.log('Sent It')
          }, 10000)
        }
    });
  });
}).catch(err => {
  console.log('PLC ERROR:', err)
})


  